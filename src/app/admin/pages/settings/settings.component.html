<div class="settings-container">
    <p-confirmDialog></p-confirmDialog>
    
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

    <div class="settings-section">
        <h3>–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</h3>
        <p class="description">
            –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞—Å—á–µ—Ç–µ –∫–æ–º–∏—Å—Å–∏–∏ –∏ —Å–ø–∏—Å–∞–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ —Å –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        </p>

        <!-- <div class="language-controls">
            <label>–¢–µ–∫—É—â–∏–π —è–∑—ã–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
            <p-button *ngFor="let lang of ['ru', 'en']" [label]="lang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'English'"
                [styleClass]="currentLanguage === lang ? 'p-button-primary' : 'p-button-outlined'"
                (click)="onLanguageChange(lang)">
            </p-button>
        </div> -->

        <p-button label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç" icon="pi pi-pencil" styleClass="p-button-primary"
            (click)="onEditCommissionText()" pTooltip="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–º–∏—Å—Å–∏–∏">
        </p-button>
    </div>

    <div class="settings-section" *ngIf="vm$ | async as vm">
        <h3>–í–æ—Ä–æ–Ω–∫–∞</h3>
        <p class="description">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –±–æ—Ç–∞.
        </p>

        <div class="scenes-list-settings" *ngIf="vm.scenes && vm.scenes.length > 0">
            <div *ngFor="let scene of vm.scenes" class="scene-item-wrapper">
                <p-button [label]="scene.name || scene.sceneId" 
                    icon="pi pi-pencil" styleClass="p-button-sm p-button-outlined scene-button"
                    (click)="onEditFunnel(scene)" [pTooltip]="'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω—É ' + (scene.name || scene.sceneId)">
                </p-button>
                <p-button icon="pi pi-trash" 
                    styleClass="p-button-sm p-button-danger p-button-outlined scene-delete-button"
                    (click)="onDeleteScene(scene)" [pTooltip]="'–£–¥–∞–ª–∏—Ç—å —Å—Ü–µ–Ω—É ' + (scene.name || scene.sceneId)">
                </p-button>
            </div>
        </div>

        <div class="funnel-actions">
            <p-button label="–î–æ–±–∞–≤–∏—Ç—å —Å—Ü–µ–Ω—É" icon="pi pi-plus" styleClass="p-button-success"
                (click)="onAddNewScene()" pTooltip="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É">
            </p-button>
        </div>
    </div>

    <div class="settings-section" *ngIf="vm$ | async as vm">
        <h3>–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–æ—Ç–æ–≤</h3>
        <p class="description">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –∏ –æ–ø–∏—Å–∞–Ω–∏–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –±–æ—Ç–æ–≤.
        </p>

        <div class="strategies-list">
            <div class="strategy-item" *ngFor="let strategy of vm.botStrategies">
                <div class="strategy-info">
                    <div class="strategy-name">
                        {{ strategy.name }} ({{ strategy.strategyId }})
                        <p-badge *ngIf="strategy.isSpot === true" value="–°–ø–æ—Ç" severity="info" styleClass="strategy-spot-badge"></p-badge>
                        <i class="pi pi-info-circle strategy-info-icon" (click)="onShowCalculations(strategy)"
                            pTooltip="–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤"></i>
                    </div>
                    <div class="strategy-description">{{ strategy.description }}</div>
                    <div class="strategy-money-policy"
                        *ngIf="strategy.minDeposit || strategy.actualLeverage || strategy.botCount !== undefined || strategy.realLeverage !== undefined">
                        <span class="policy-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏:</span>
                        <span *ngIf="strategy.minDeposit" class="policy-item">–ú–∏–Ω. –¥–µ–ø–æ–∑–∏—Ç: {{ strategy.minDeposit
                            }}</span>
                        <span *ngIf="strategy.actualLeverage" class="policy-item">–§–∞–∫—Ç –ø–ª–µ—á–æ: {{ strategy.actualLeverage
                            }}x</span>
                        <span *ngIf="strategy.botCount !== undefined" class="policy-item">–ö–æ–ª-–≤–æ –±–æ—Ç–æ–≤: {{
                            strategy.botCount }}</span>
                        <span *ngIf="strategy.realLeverage !== undefined" class="policy-item">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ: {{
                            strategy.realLeverage }}x</span>
                    </div>
                </div>
                <div class="strategy-actions">
                    <p-button icon="pi pi-pencil" styleClass="p-button-sm p-button-outlined"
                        (click)="onEditStrategy(strategy)" pTooltip="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é">
                    </p-button>
                    <p-button icon="pi pi-cog" styleClass="p-button-sm p-button-outlined"
                        (click)="onEditMoneyPolicy(strategy)" pTooltip="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–Ω–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏">
                    </p-button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for editing commission text -->
<app-edit-commission-text-modal *ngIf="vm$ | async as vm" [visible]="isModalVisible" [currentTexts]="vm.commissionTexts"
    [currentLanguage]="vm.currentLanguage" [loading]="vm.isLoading" (visibleChange)="onModalClose()"
    (save)="onSaveCommissionText($event)">
</app-edit-commission-text-modal>

<!-- Modal for editing bot strategy -->
<app-edit-bot-strategy-modal *ngIf="vm$ | async as vm" [visible]="isStrategyModalVisible" [strategy]="selectedStrategy"
    [loading]="vm.isLoading" (visibleChange)="onStrategyModalClose()" (save)="onSaveStrategy($event)">
</app-edit-bot-strategy-modal>

<!-- Modal for editing strategy money policy -->
<app-edit-strategy-money-policy-modal *ngIf="vm$ | async as vm" [visible]="isMoneyPolicyModalVisible"
    [strategy]="selectedStrategy" [loading]="vm.isLoading" (visibleChange)="onMoneyPolicyModalClose()"
    (save)="onSaveMoneyPolicy($event)">
</app-edit-strategy-money-policy-modal>

<!-- Modal for editing funnel -->
<app-edit-funnel-modal *ngIf="vm$ | async as vm" [visible]="isFunnelModalVisible"
    [scene]="selectedScene" [loading]="vm.isScenesLoading" [allScenes]="vm.scenes"
    (visibleChange)="onFunnelModalClose()" (save)="onSaveScene($event)">
</app-edit-funnel-modal>

<!-- Modal for deposit calculations -->
<p-dialog [(visible)]="isCalculationsModalVisible" [modal]="true" [dismissableMask]="true" [draggable]="false"
    [resizable]="false" styleClass="calculations-modal" (onHide)="onCalculationsModalClose()">
    <ng-template pTemplate="header">
        <div class="modal-header-custom">
            <h3>üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–Ω–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏</h3>
            <div class="strategy-title" *ngIf="selectedStrategy">
                {{ selectedStrategy.name }} ({{ selectedStrategy.strategyId }})
            </div>
        </div>
    </ng-template>

    <div class="calculations-content" *ngIf="selectedStrategy">
        <div class="no-settings-message"
            *ngIf="!selectedStrategy.minDeposit && !selectedStrategy.actualLeverage && selectedStrategy.botCount === undefined && selectedStrategy.realLeverage === undefined">
            <i class="pi pi-info-circle"></i>
            <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–Ω–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã</span>
        </div>


        <!-- –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ -->
        <div class="deposit-variants" *ngIf="selectedStrategy.minDeposit && selectedStrategy.botCount">
            <!-- –ö–∞—Ä—Ç–∞ 1: –ù–∞ 15% –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ -->
            <div class="variant-card" style="border-left-color: #ff9800;">
                <div class="variant-header">
                    <span class="variant-icon">‚ö†Ô∏è</span>
                    <span class="variant-title">–ù–∞ 15% –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ</span>
                </div>
                <div class="variant-deposit">
                    {{ calculateDeposit1() | number:'1.0-2' }} USDT
                </div>
                <div class="variant-note" style="color: #f57c00; font-size: 12px; margin-bottom: 12px;">
                    <i class="pi pi-exclamation-triangle"></i>
                    –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç
                </div>
                <div class="bot-count-section">
                    <div class="bot-count-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ—Ç–æ–≤</div>
                    <div class="bot-count-value">{{ calculateBotCount(calculateDeposit1()) }}</div>
                </div>
                <div class="wallet-size-section">
                    <div class="wallet-size-header">
                        <i class="pi pi-wallet"></i>
                        <span>–†–∞–∑–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞</span>
                    </div>
                    <div class="wallet-size-results">
                        <div class="wallet-result-item">
                            <span class="result-label">–õ–æ–Ω–≥, %</span>
                            <span class="result-value">{{ calculateLongPercent(calculateDeposit1()) | number:'1.0-2'
                                }}%</span>
                        </div>
                        <div class="wallet-result-item">
                            <span class="result-label">–®–æ—Ä—Ç, USDT</span>
                            <span class="result-value">{{ calculateShortUsdt(calculateDeposit1()) | number:'1.0-2'
                                }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ 2: –°—Ä–µ–¥–Ω—è—è —Ü–∏—Ñ—Ä–∞ -->
            <div class="variant-card" style="border-left-color: #2196F3;">
                <div class="variant-header">
                    <span class="variant-icon">üìä</span>
                    <span class="variant-title">–°—Ä–µ–¥–Ω–∏–π –¥–µ–ø–æ–∑–∏—Ç</span>
                </div>
                <div class="variant-deposit">
                    {{ calculateDeposit2() | number:'1.0-2' }} USDT
                </div>
                <div class="variant-note" style="color: #1976D2; font-size: 12px; margin-bottom: 12px;">
                    <i class="pi pi-info-circle"></i>
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –±–∞–ª–∞–Ω—Å
                </div>
                <div class="bot-count-section">
                    <div class="bot-count-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ—Ç–æ–≤</div>
                    <div class="bot-count-value">{{ calculateBotCount(calculateDeposit2()) }}</div>
                </div>
                <div class="wallet-size-section">
                    <div class="wallet-size-header">
                        <i class="pi pi-wallet"></i>
                        <span>–†–∞–∑–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞</span>
                    </div>
                    <div class="wallet-size-results">
                        <div class="wallet-result-item">
                            <span class="result-label">–õ–æ–Ω–≥, %</span>
                            <span class="result-value">{{ calculateLongPercent(calculateDeposit2()) | number:'1.0-2'
                                }}%</span>
                        </div>
                        <div class="wallet-result-item">
                            <span class="result-label">–®–æ—Ä—Ç, USDT</span>
                            <span class="result-value">{{ calculateShortUsdt(calculateDeposit2()) | number:'1.0-2'
                                }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ 3: –£–¥–≤–æ–µ–Ω–Ω—ã–π -->
            <div class="variant-card" style="border-left-color: #4CAF50;">
                <div class="variant-header">
                    <span class="variant-icon">üíé</span>
                    <span class="variant-title">–£–¥–≤–æ–µ–Ω–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç</span>
                </div>
                <div class="variant-deposit">
                    {{ calculateDeposit3() | number:'1.0-2' }} USDT
                </div>
                <div class="variant-note" style="color: #388E3C; font-size: 12px; margin-bottom: 12px;">
                    <i class="pi pi-check-circle"></i>
                    –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
                </div>
                <div class="bot-count-section">
                    <div class="bot-count-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ—Ç–æ–≤</div>
                    <div class="bot-count-value">{{ calculateBotCount(calculateDeposit3()) }}</div>
                </div>
                <div class="wallet-size-section">
                    <div class="wallet-size-header">
                        <i class="pi pi-wallet"></i>
                        <span>–†–∞–∑–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞</span>
                    </div>
                    <div class="wallet-size-results">
                        <div class="wallet-result-item">
                            <span class="result-label">–õ–æ–Ω–≥, %</span>
                            <span class="result-value">{{ calculateLongPercent(calculateDeposit3()) | number:'1.0-2'
                                }}%</span>
                        </div>
                        <div class="wallet-result-item">
                            <span class="result-label">–®–æ—Ä—Ç, USDT</span>
                            <span class="result-value">{{ calculateShortUsdt(calculateDeposit3()) | number:'1.0-2'
                                }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ 4: –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤–≤–æ–¥ -->
            <div class="variant-card custom-card" style="border-left-color: #9C27B0;">
                <div class="variant-header">
                    <span class="variant-icon">‚úèÔ∏è</span>
                    <span class="variant-title">–í–∞—à –¥–µ–ø–æ–∑–∏—Ç</span>
                </div>
                <div class="custom-input-wrapper">
                    <input type="number" class="custom-deposit-input" [(ngModel)]="customDeposit"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" (input)="onCustomDepositChange()" min="0" step="100">
                    <span class="input-currency">USDT</span>
                </div>
                <div class="variant-note"
                    style="color: #7B1FA2; font-size: 12px; margin-top: 8px; margin-bottom: 12px;">
                    <i class="pi pi-calculator"></i>
                    –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ä–∞—Å—á–µ—Ç
                </div>
                <div class="bot-count-section" *ngIf="customDeposit > 0">
                    <div class="bot-count-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ—Ç–æ–≤</div>
                    <div class="bot-count-value">{{ calculateBotCount(customDeposit) }}</div>
                </div>
                <div class="wallet-size-section" *ngIf="customDeposit > 0">
                    <div class="wallet-size-header">
                        <i class="pi pi-wallet"></i>
                        <span>–†–∞–∑–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞</span>
                    </div>
                    <div class="wallet-size-results">
                        <div class="wallet-result-item">
                            <span class="result-label">–õ–æ–Ω–≥, %</span>
                            <span class="result-value">{{ calculateLongPercent(customDeposit) | number:'1.0-2'
                                }}%</span>
                        </div>
                        <div class="wallet-result-item">
                            <span class="result-label">–®–æ—Ä—Ç, USDT</span>
                            <span class="result-value">{{ calculateShortUsdt(customDeposit) | number:'1.0-2' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer-note">
            <i class="pi pi-check-circle"></i>
            <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–Ω–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</span>
        </div>
    </div>
</p-dialog>