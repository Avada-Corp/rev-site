<p-toast></p-toast>
<div class="container mainContainer">
    <div class="btnContainer">
        <p-button *ngIf="isAdmin" styleClass="p-button-help" routerLink="/admin/api-table">Admin</p-button>
        <p-button styleClass="p-button-help" routerLink="/stat">Statistic</p-button>
        <p-button *ngIf="isTgEmail()" label="Привязать email" (click)="addEmailToTg()"
            icon="pi pi-user-plus"></p-button>
        <p-button label="Referral" (click)="showRefInfo()"></p-button>
        <p-button label="Добавить api" (click)="showAddApi()"></p-button>
        <p-button class="logout-btn" icon="pi pi-check" styleClass="p-button-danger" (click)="logout()"
            label="Logout"></p-button>
    </div>
    <div>
        <p-table *ngIf="apiArray.length > 0" [value]="apiArray"
            [tableStyle]="{ 'min-width': '30rem', 'max-width': '70rem' }">
            <ng-template pTemplate="header">
                <tr>
                    <th>Name</th>
                    <th>Market</th>
                    <th>Key</th>
                    <th>Secret</th>
                    <th>Status</th>
                    <th>started/stopped/wait for start/wait for stop</th>
                    <th>Actions</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-api>
                <tr>
                    <td>{{ api.name }}</td>
                    <td>{{ api.market }}</td>
                    <td>{{ api.key.slice(0, 10) }}...</td>
                    <td>{{ api.secret }}</td>
                    <td>{{ api.status?.status || "Stopped" }}</td>
                    <td>{{ api.status?.started || 0 }} / {{ api.status?.stopped || 0 }} / {{
                        api.status?.waitForStart || 0}} / {{
                        api.status?.waitForStop || 0 }} </td>
                    <td><app-bot-action-button [status]="api.status" [apiId]="api.id"
                            [email]="email"></app-bot-action-button></td>
                    <td class="btns">
                        <p-button icon="pi pi-pencil" styleClass="p-button-danger" (onClick)="editApi(api)"></p-button>
                        <p-button icon="pi pi-times" styleClass="p-button-danger" (onClick)="removeApi(api)"></p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
<p-dialog header="Api key" [(visible)]="isEdit" [style]="{width: '50vw'}">
    <app-api-form [email]="email" [api]="editApiInfo" (closeFormEvent)="closeApiForm()"></app-api-form>
</p-dialog>

<p-dialog header="Add email" [(visible)]="isAddEmail" [style]="{width: '50vw'}">
    <app-add-email (closeFormEvent)="closeEmailForm()" [email]="email"></app-add-email>
</p-dialog>

<p-dialog header="Referral information" [(visible)]="isRefInfo" [style]="{width: '50vw'}">
    <!-- <div *ngIf="refLink">
        <span class="headline">Реферальная ссылка:</span>
        <a [href]="refLink" target="_blank">{{ refLink }}</a>
    </div> -->
    <app-refferal-grid *ngIf="accountId" [accountId]="accountId"></app-refferal-grid>
</p-dialog>